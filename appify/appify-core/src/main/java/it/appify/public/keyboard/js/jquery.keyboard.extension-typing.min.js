/*! jQuery UI Virtual Keyboard Typing Simulator v1.9 */
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){a.fn.addTyping=function(b){var c={showTyping:!0,lockTypeIn:!1,delay:250},d=a.keyboard;return this.each(function(){var e,f=a(this).data("keyboard");f&&(e=f.typing_options=a.extend({},c,b),f.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","{b}":"bksp","{d}":"del","{l}":"left","{r}":"right","\n":"enter","\r":"enter","{e}":"enter","	":"tab","{t}":"tab"},f.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space",46:"del"},f.typing_event=!1,f.typing_namespace=f.namespace+"typing",e.savedLockInput=f.options.lockInput,f.typing_setup=function(){var a=d.events,b=f.typing_namespace;f.$el.add(f.$preview).unbind(b),f.$el.bind([a.kbHidden,a.kbInactive,""].join(b+" "),function(a){f.typing_reset()}).bind(d.events.kbBeforeVisible+b,function(){f.typing_setup()}),f.$allKeys.bind("mousedown"+b,function(){f.typing_reset()}),f.$preview.bind("keyup"+b,function(a){if(e.init&&e.lockTypeIn)return!1;if(!(a.which>=37&&a.which<=40))return 16===a.which&&(f.shiftActive=!1),18===a.which&&(f.altActive=!1),16===a.which||18===a.which?(f.showKeySet(),void setTimeout(function(){f.$preview.focus()},200)):void 0}).bind("keydown"+b,function(a){return e.init&&e.lockTypeIn?!1:(a.temp=!1,16===a.which&&(a.temp=!f.shiftActive,f.shiftActive=!0),18===a.which&&(a.temp=!f.altActive,f.altActive=!0),a.temp&&(f.showKeySet(),f.$preview.focus()),f.typing_event=!0,void((8===a.which||9===a.which)&&f.typing_findKey("",a)))}).bind("keypress"+b,function(a){return e.init&&e.lockTypeIn?!1:void(f.typing_event&&!f.options.lockInput&&(f.typing_reset(),f.typing_event=!0,f.typing_findKey("",a)))})},f.typing_reset=function(){f.typing_event=e.init=!1,e.text="",e.len=e.current=0,f.options.lockInput=e.savedLockInput},f.typeIn=function(a,b,c,d){if(!f.isVisible())return clearTimeout(f.typing_timer),void f.typing_reset();if(f.typing_event){if("undefined"==typeof a)return f.typing_event=!1,void(f.options.lockInput=e.savedLockInput)}else e.init!==!0&&(e.init=!0,f.options.lockInput=e.lockTypeIn,e.text=a||e.text||"",e.len=e.text.length,e.delay=b||300,e.current=0,c&&(e.callback=c)),a=e.text.substring(e.current,++e.current),"{"===a&&"}"===e.text.substring(e.current+1,e.current+2)&&(a+=e.text.substring(e.current,e.current+=2)),f.typing_findKey(a,d)},f.typing_findKey=function(b,c){var g,h,i,j,k,l,m,n,o=d.css,p=d.builtLayouts[f.layout].mappedKeys;if(f.isOpen&&f.$keyboard.length)if(l=f.$keyboard.find("."+o.keySet),j=b in f.typing_keymap?f.typing_keymap[b]:b,g="."+o.keyButton+'[data-action="'+j+'"]',f.typing_event&&c&&(f.typing_xref.hasOwnProperty(c.keyCode||c.which)?g="."+o.keyPrefix+f.typing_xref[c.keyCode||c.which]:(h=String.fromCharCode(c.charCode||c.which),g=p.hasOwnProperty(h)?"."+o.keyButton+'[data-action="'+p[h]+'"]':"."+o.keyPrefix+(c.charCode||c.which))),k=l.filter(":visible").find(g),k.length?f.typing_simulateKey(k,b,c):(f.typing_event?k=l.find(g):(i=b in f.typing_keymap?f.typing_keymap[b]:b.charCodeAt(0),k=l.find("."+o.keyPrefix+i)),n=k.closest("."+o.keySet),n.attr("name")?(m=n.attr("name"),f.shiftActive=/shift/.test(m),f.altActive=/alt/.test(m),f.metaActive=f.last.keyset[2]=m.match(/meta\d+/)||!1,f.showKeySet({name:f.metaActive}),f.typing_simulateKey(k,b,c)):f.typing_event||(b in f.typing_keymap&&f.typing_keymap[b]in d.keyaction?d.keyaction[f.typing_keymap[b]](f,k,c):f.insertText(b),f.checkCombos(),f.$el.trigger(d.events.kbChange,[f,f.el]))),e.current<=e.len&&0!==e.len){if(!f.isVisible())return;setTimeout(function(){f.typeIn()},e.delay)}else{if(0!==e.len)return f.typing_reset(),void(a.isFunction(e.callback)&&setTimeout(function(){a.isFunction(e.callback)&&e.callback(f)},e.delay));f.typing_reset()}},f.typing_simulateKey=function(b,c,g){var h=b.length;h&&b.filter(":visible").trigger("mouseenter"+f.namespace),f.typing_timer=setTimeout(function(){var h=b.length;h&&setTimeout(function(){b.trigger("mouseleave"+f.namespace)},e.delay/3),f.isVisible()&&(f.typing_event||(c in f.typing_keymap&&f.typing_keymap[c]in d.keyaction?(g=g||a.Event("keypress"),g.target=b,d.keyaction[f.typing_keymap[c]](f,b,g)):f.insertText(c),f.checkCombos(),f.$el.trigger(d.events.kbChange,[f,f.el])))},e.delay/3)},e.showTyping&&(f.options.alwaysOpen&&f.isVisible()&&f.typing_setup(),f.$el.bind(d.events.kbBeforeVisible+f.typing_namespace,function(){f.typing_setup()})))})}});